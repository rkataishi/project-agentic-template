# TOFA-WDF: Complete Architecture & Workflow Overview (v4.0)

## What is TOFA-WDF?

**TOFA-WDF** (Task-Oriented Functional Architecture with Decoupled Flows) is a systematic approach to Python scripting that separates concerns into four distinct layers, ensuring code is modular, testable, and traceable.

## The Four-Tier Architecture

Think of it as a **factory assembly line**:

1.  **Modules** (`simple/`) → **Atomic workers** doing one specific job (inside a task's `functions/` directory).
2.  **Orchestrators** (`orchestrators/`) → **Team leaders** coordinating workers (inside a task's `functions/` directory).
3.  **Flows** (`flows/`) → **Factory managers** coordinating multiple teams (at the project root).
4.  **Scripts** (`scripts/`) → **Control room** receiving external commands (inside a task's directory).

## Philosophical Foundation

**Modularity is absolute** - No function crosses its layer. Scripts do not host logic. Flows do not perform operations. Modules do not access context.

**Reflexivity is strict** - No task is done without audit. Every decision has a trace. Every failure is logged. Every success is remembered.

## Quick Start: Your First 5 Minutes

```bash
# 1. Create a new task (this populates docs/pipeline/ with tracking files)
task prd "Process CSV files and generate reports"

# 2. Check what you're working on
cat docs/pipeline/microtasks.md

# 3. See the project structure
tree tasks/
```

## File Map: Where Everything Lives

```plaintext
project/
├── data_processing/          # Capability-specific task
│   ├── scripts/
│   ├── functions/
│   │   ├── simple/
│   │   └── orchestrators/
│   └── test_data/
├── automation/                 # Another capability
├── reporting/                  # Another capability
│
├── tasks/                    # Task Master generated markdown files
│   └── *.md
│
├── docs/                     # All project and workflow documentation
│   ├── code_review_manual.md
│   ├── cross_task_coordination.md
│   ├── doc_guidelines.md
│   ├── test_data_policy.md
│   ├── rules/                # Centralized project rules
│   │   ├── self_improve.md
│   │   ├── vscode_rules.md
│   │   └── knowledge_sync_policy.md
│   ├── pipeline/             # Reflexive memory, planning, and workflow guides
│   │   ├── prd.md              # <-- Generated by `task` command
│   │   ├── task_contract.md    # <-- Generated by `task` command
│   │   ├── microtasks.md       # <-- Generated by `task` command
│   │   ├── memories.md         # <-- Generated by `task` command
│   │   ├── learning_by_doing.md# <-- Generated by `task` command
│   │   ├── pipeline_development.md # Static workflow guide
│   │   ├── pipeline_pickup.md      # Static workflow guide
│   │   ├── pipeline_tofa_wdf_overview.md # Static workflow guide
│   │   └── pipeline_workflow.md    # Static workflow guide
│   └── templates/            # Templates for generating pipeline files
│       ├── pipeline_template_learning_by_doing.md
│       ├── pipeline_template_memories.md
│       └── pipeline_template_task_contract.md
│
├── flows/                    # Cross-task coordination
├── shared_modules/           # Reusable utilities
├── config/
│   └── config.py
└── external_knowledge/       # External library documentation
```

## The Golden Rules

1.  **Never write code without a test** - Every function must have a unit test.
2.  **Never lose context** - Everything goes in `docs/pipeline/` files.
3.  **Never build without a plan** - Use `docs/pipeline/microtasks.md` for current work.
4.  **Never repeat mistakes** - Document failures in `docs/pipeline/memories.md`.
5.  **Never cross layer boundaries** - Scripts don't contain logic, flows don't perform operations.
6.  **Never proceed without 95% certainty** - Document alternatives when uncertain.
7.  **Never ignore errors** - All predictable exceptions must be handled explicitly, and all unexpected failures must be logged and documented.

## Task Contracts & Testing

Every task has a **contract** (`docs/pipeline/task_contract.md`) that defines:
- Required outputs
- Performance bounds
- Test conditions
- Environmental assumptions

**Testing is mandatory**:
- Each function has a unit test using real data (no synthetic inputs).
- Each flow is validated by terminal output.
- No script is valid without dry-run and verbose testing.
- Completion requires contract fulfillment.

## Typical Workflow

1.  **Start**: `task prd "My task description"` creates tracking files (e.g., `prd.md`, `microtasks.md`) inside `docs/pipeline/` using the `docs/templates/` directory.
2.  **Plan**: Edit `docs/pipeline/microtasks.md` with your current sub-task.
3.  **Build**: Create Modules → Orchestrators → Flows → Scripts.
4.  **Test**: Every step gets validated against real data.
5.  **Document**: Every change gets logged in the appropriate `docs/pipeline/` file.
6.  **Finish**: Archive microtask, update memories, mark complete.

## When You Return Tomorrow

1.  Read `docs/pipeline/prd.md` - remember the big picture.
2.  Read `docs/pipeline/microtasks.md` - remember where you left off.
3.  Read `docs/pipeline/memories.md` - remember what didn't work.
4.  Resume work following the development pipeline.

## Key Files to Know

-   **`docs/pipeline/pipeline_tofa_wdf_overview.md`** → This quick reference.
-   **`docs/pipeline/pipeline_workflow.md`** → Complete architectural specification.
-   **`docs/pipeline/pipeline_development.md`** → Step-by-step implementation process.
-   **`docs/pipeline/pipeline_pickup.md`** → How to resume work after interruptions.
-   **`docs/pipeline/microtasks.md`** → Your current active work.

## Documentation Structure & Guidelines

**Important**: This project uses a strict separation between workflow documentation and external library documentation:

-   **`docs/`** → Contains all documentation related to project execution, planning, and memory.
    -   Top-level files like `code_review_manual.md` and `test_data_policy.md` define project-wide standards.
    -   The **`docs/pipeline/`** directory is the system's core, containing both *dynamic* tracking files (`prd.md`, `microtasks.md`) and *static* guides on how to follow the workflow (`pipeline_workflow.md`).
    -   The **`docs/templates/`** directory holds the blueprints for all dynamic pipeline files.

-   **`external_knowledge/`** → Contains external libraries documentation and integration guides.
    -   Use for: External library documentation, API references, integration examples.

**Reference**: For any questions about taskmaster functionality, consult `external_knowledge/docs_task-master.md` as the authoritative source.

## In One Sentence

TOFA-WDF is a systematic way to build Python scripts that ensures you never lose context, never repeat mistakes, and always know exactly what to build next—while maintaining absolute modularity and complete traceability.